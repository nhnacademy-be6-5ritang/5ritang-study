# JsonWebToken의 검증 이유
사용자의 권한을 확인할 때, 현재 요청을 보낸 사용자가 누구인지를 파악할 때 JWT를 사용한다.
이러한 JWT가 우리가 발급한 JWT인지, 위조된 건 아닌지, 유통기한(만료)이 지난 건 아닌지, 등의 검증을 해야한다.

# 우리의 아키텍처
<div align="center">
  <img src="https://github.com/nhnacademy-be6-5ritang/book-store-back/assets/111658806/f9034d04-ff31-4740-b06e-788acaf88654"/>
</div>

<br/>

'오리탕 온라인 서점 프로젝트'에서는 JWT를 발급하는 인증 서버(AUTH SERVER), 쿠폰 관련 데이터를 다루는 쿠폰 서버(COUPON SERVER), 나머지 도서, 주문, 결제 등을 관리하는 애플리케이션 서버(API SERVER)로 구성되어 있고, 클라이언트(FRONT SERVER)에서 오는 요청을 스프링 클라우드 게이트웨이(GATEWAY)가 알맞는 서버로 라우팅 한다.

JWT는 인증 서버에서 발급한다면, 그럼 어디서 검증 하는 것이 좋을까?

다음은 3가지의 가능한 경우들이다:
- AUTH SERVER
- API SERVER, COUPON SERVER
- CLOUD GATEWAY

<br/>

### 인증 서버(AUTH SERVER)에서 JWT 검증

- 장점 :
- - 인증 서버에서 인증과 관련된 모든 로직을 처리하므로 관련 개발자가 보안에 집중할 수 있다.
- - 애플리케이션 서버는 인증에 신경 쓰지 않고 비즈니스 로직에 집중할 수 있다.

- 단점 :
- - 클라이언트로부터 오는 모든 요청에 대해 인증 서버를 꼭 거쳐야 하기 때문에 네트워크 지연이 발생할 수 있다(느려질 수 있다).
- - 인증 서버의 장애가 곧 전체 애플리케이션 서버의 장애다.

<br/>

### 애플리케이션 + 쿠폰 서버(API + COUPON SERVER)에서 JWT 검증

- 장점 :
- - 애플리케이션 서버(도서, 주문, 결제, 회원정보 등 담당)와 쿠폰 서버가 독립적으로 검증을 진행하기 때문에 부하가 분산된다.
- - 애플리케이션 서버를 독립적으로 확장할 수 있다.

- 단점 :
- - 애플리케이션 서버마다 JWT 검증 로직이 중복될 수 있다.
- - 모든 서버에 동일한 보안 정책을 유지해야 하기 때문에 관리가 복잡해질 수 있다.
- - (내 의견) 검증 결과 재발급 받을 수 있는 경우에는 인증 서버를 다시 가야하는데 이 경우에는 네트워크 지연이 발생할 것 같다.

<br/>

### 클라우드 게이트웨이(CLOUD GATEWAY)에서 JWT 검증

- 장점 :
- - 클라이언트의 모든 요청이 게이트웨이를 통과하기 때문에 중앙에서 일괄적으로 검증할 수 있다.
- - 애플리케이션 서버에서 인증과 관련해서는 신경 쓰지 않아도 된다.
- - 모든 서비스가 일관된 보안 정책을 적용할 수 있다.

- 단점 :
- - 게이트웨이의 문제가 곧 전체 애플리케이션 서버의 장애다.
- - 트래픽이 많아지면 게이트웨이의 부하가 커진다.

<br/>

### 결론
네트워크 경로를 기준으로 JWT 검증은 클라우드 게이트웨이에서 처리하는 것이 가장 효율적이며, 애플리케이션 서버의 확장성, 일관된 보안의 장점이 있다.
하지만 클라우드 게이트웨이의 장애는 전체 애플리케이션 서버에 위험 요소가 되기 때문에 이중화를 통해 고가용성을 확보하는 것이 안전할 것이다.